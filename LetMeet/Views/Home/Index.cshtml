@using System.Security.Claims;
@using LetMeet.Data.Entites.UsersInfo;
@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>


@inject IHttpContextAccessor _httpContextAccessor

@{

    if (_httpContextAccessor.HttpContext.User.Identity.IsAuthenticated)
    {

        string userName = _httpContextAccessor.HttpContext.User.FindFirstValue(ClaimTypes.Name) ?? "UnKnown";
        string userId = _httpContextAccessor.HttpContext.User.FindFirstValue(ClaimTypes.NameIdentifier) ?? "01";
        var roles = _httpContextAccessor.HttpContext.User.FindAll(ClaimTypes.Role);

        foreach (var item in roles)
        {
            <h4>@item.Value</h4>
        }

        <h3>@userName</h3>
        <h3>@userId</h3>
    }
}
@{
    string studentName = "Mohammed Al Mustafa Adel";
    string studentId = "201700000";
    string meetingDate = "2019-12-12";
    string meetingHumanDate = "Today";
    string meetingDescription = "he place is close to Barceloneta Beach and bus stop just 2 min by walk and near to  where you can enjoy the main night life in Barcelona ";

    string numberOfTasks = "7";
    string numberOfTasksDone = "3";
    string numberOfTasksNotDone = "4";
    int meetingId = 1;

}
@*Meeting Card*@

<div class="row ">

    <div class="col-lg-4 col-xl-6 col-md-6 col-sm-12">
        <div class="card equal-height-card meeting-card">
            <div class="card-header card-header-primary">
                <h4 class="card-title">With @studentName</h4>
                <p class="category d-flex justify-content-between">
                    <span>@meetingDate</span>
                    <span class="badge-success rounded p-2">@meetingHumanDate </span>
                </p>
            </div>
            <div class="card-body position-relative ">

                <p>@meetingDescription</p>
                <div class="d-flex justify-content-between flex-wrap tasks-container">
                    <div>
                        Tasks: @numberOfTasks
                    </div>

                    <div>Done: @numberOfTasksDone / @numberOfTasks</div>
                    <div>Not Done: @numberOfTasksNotDone / @numberOfTasks</div>
                </div>

                <div class="d-flex justify-content-center align-items-center meet-overlay">

                    <button class="btn btn-success m-1" rel="tooltip" title="" data-original-title="Run Meeting">
                        <i class="material-icons">not_started</i>
                    </button>

                    <button rel="tooltip" title="" data-original-title="Show Meeting" class="btn btn-info m-1">
                        <i class="material-icons">visibility</i>
                    </button>

                    <!--delete meeting form must contains meet id and current userId-->
                    <form>
                        <input type="hidden" name="userId" value="@_httpContextAccessor.HttpContext.User.FindFirstValue(ClaimTypes.NameIdentifier)" />
                        <input type="hidden" name="meetingId" value="@meetingId" />

                        <button rel="tooltip" title="" data-original-title="Delete Meeting" type="submit" onclick="return confirm('Are you sure you want to delete this meeting ?');" class="btn btn-danger">
                            <i class="material-icons">delete</i>
                        </button>

                    </form>


                </div>
            </div>

        </div>

    </div>

</div>


<style>
    .equal-height-card {
        display: flex;
        flex-direction: column;
        height: 80%;
    }

    .equal-height-card .card-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .tasks-container {
        margin-top: auto;
    }

    /*meeting description truncted */
    .meeting-card p {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }

    /*meeting overlay for delete and other buttons*/
    .meet-overlay {
        position: absolute;
        /*width: fit-content;*/
        width: 100%;
        height: 0%;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: gray;
        overflow: hidden;
        transition: .3s ease;
        z-index: 100;
        border-top-left-radius: 6px;
        border-top-right-radius: 6px;
        /*margin:  0 auto;*/
        padding: 0 5px;
    }

    .meeting-card:hover .meet-overlay {
        height: 40%;
    }
</style>
